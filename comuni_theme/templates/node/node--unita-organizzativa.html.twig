<div class="container">
  <div class="row justify-content-center">
    <div class="col">
      <div class="cmp-heading pb-3 pb-lg-4">
        <div class="row">
          <div class="col-lg-8">
            {{ title_prefix }}
            {% if node.label %}
              <h1{{ title_attributes.addClass('title-xxxlarge') }} data-element="service-title">
                {{ node.label }}
              </h1>
            {% endif %}
            {{ title_suffix }}
            {% if content.field_descrizione_breve %}
              <div class="subtitle-small mb-3" data-element="service-description">
                {{ content.field_descrizione_breve }}
              </div>
            {% endif %}
          </div>
          <div class="col-lg-3 offset-lg-1 mt-5 mt-lg-0">
            {{ drupal_block("social_sharing_buttons_block") }}
            <div class="dropdown">
              <button type="button" id="viewActions" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"
                class="btn btn-dropdown dropdown-toggle text-decoration-underline d-inline-flex align-items-center fs-0"
                aria-label="vedi azioni da compiere sulla pagina">
                <svg class="icon">
                  <use href="#it-more-items" />
                </svg>
                <small>Vedi azioni</small>
              </button>
              <div class="dropdown-menu shadow-lg" aria-labelledby="viewActions">
                <div class="link-list-wrapper">
                  <ul class="link-list">
                    <li>
                      <a class="list-item" href="javascript:window.print()">
                        <svg class="icon">
                          <use href="#it-print" />
                        </svg>
                        <span>Stampa</span>
                      </a>
                    </li>
                    <li>
                      <a class="list-item" href="#">
                        <svg class="icon">
                          <use href="#it-hearing" />
                        </svg>
                        <span>Ascolta</span>
                      </a>
                    </li>
                    <li>
                      <a class="list-item" href="mailto:?subject={{ node.label }}&body={{ url }}"
                         target="_blank" rel="noopener">
                        <svg class="icon">
                          <use href="#it-mail" />
                        </svg>
                        <span>Invia</span>
                      </a>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="mt-4 mb-4">
              {% if content.field_argomenti[0] is not empty %}
                <span class="subtitle-small">Argomenti</span>
                <div class="chip-wrapper mt-2">
                  {% for item in attribute(content.field_argomenti, "#items") %}
                    {% set arg_name = item.entity.name.value %}
                    <a href="{{ path('entity.taxonomy_term.canonical', {'taxonomy_term': item.target_id}) }}" data-element="service-topic">
                      <div class="chip chip-simple chip-primary">
                        <span class="chip-label">{{ arg_name }}</span>
                      </div>
                    </a>
                  {% endfor %}
                </div>
              {% endif %}
            </div>
            <div class="mt-4 mb-4">
              {% if content.field_tipo_di_organizzazione[0] is not empty %}
                <span class="subtitle-small">Tipo di Organizzazione</span>
                <div class="chip-wrapper mt-2">
                  {% for item in attribute(content.field_tipo_di_organizzazione, "#items") %}
                    {% set arg_name = item.entity.name.value %}
                    <a href="{{ path('entity.taxonomy_term.canonical', {'taxonomy_term': item.target_id}) }}">
                      <div class="chip chip-simple chip-primary">
                        <span class="chip-label">{{ arg_name }}</span>
                      </div>
                    </a>
                  {% endfor %}
                </div>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </div>
    <hr class="d-none d-lg-block mt-2">
  </div>
</div>

<div class="container">
  <div class="row row-column-menu-left mt-4 mt-lg-80 pb-lg-80 pb-40">
    <div class="col-12 col-lg-3 mb-4 border-col">
      <div class="cmp-navscroll sticky-top" aria-labelledby="accordion-title-one">
        <nav class="navbar it-navscroll-wrapper navbar-expand-lg" aria-label="INDICE DELLA PAGINA" data-bs-navscroll>
          <div class="navbar-custom" id="navbarNavProgress">
            <div class="menu-wrapper">
              <div class="link-list-wrapper">
                <div class="accordion">
                  <div class="accordion-item">
                    <span class="accordion-header" id="accordion-title-one">
                      <button class="accordion-button pb-10 px-3" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-one" aria-expanded="true" aria-controls="collapse-one">
                        INDICE DELLA PAGINA
                        <svg class="icon icon-xs right">
                          <use href="#it-expand" />
                        </svg>
                      </button>
                    </span>
                    <div class="progress">
                      <div class="progress-bar it-navscroll-progressbar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <div id="collapse-one" class="accordion-collapse collapse show" role="region" aria-labelledby="accordion-title-one">
                      <div class="accordion-body">
                        <ul class="link-list" data-element="page-index">
                          {% if content.field_competenze[0] is not empty %}
                          <li class="nav-item">
                            <a class="nav-link" href="#competenze">
                              <span class="title-medium">Competenze</span>
                            </a>
                          </li>
                          {% endif %}
                          {% if drupal_view_result('persone_collegate', 'block_3', node.id) %}
                          <li class="nav-item">
                            <a class="nav-link" href="#persone-responsabili">
                              <span class="title-medium">Responsabili</span>
                            </a>
                          </li>
                          {% endif %}
                          {% if drupal_view_result('persone_collegate', 'block_4', node.id) %}
                          <li class="nav-item">
                            <a class="nav-link" href="#persone">
                              <span class="title-medium">Persone che compongono la struttura</span>
                            </a>
                          </li>
                          {% endif %}
                          {% if drupal_view_result('servizi_collegati', 'block_2', node.id) %}
                          <li class="nav-item">
                            <a class="nav-link" href="#elenco-servizi-offerti">
                              <span class="title-medium">Servizi offerti</span>
                            </a>
                          </li>
                          {% endif %}
                          {% if content.field_sedi["#items"].0 is not empty %}
                          <li class="nav-item">
                            <a class="nav-link" href="#sede-principale">
                              <span class="title-medium">Sede principale</span>
                            </a>
                          </li>
                          {% endif %}
                          {% if content.field_contatti[0] is not empty %}
                          <li class="nav-item">
                            <a class="nav-link" href="#contatti">
                              <span class="title-medium">Contatti</span>
                            </a>
                          </li>
                          {% endif %}
                          {% if content.field_unita_org_genitore[0] is not empty %}
                          <li class="nav-item">
                            <a class="nav-link" href="#unita-org-genitore">
                              <span class="title-medium">Ufficio responsabile</span>
                            </a>
                          </li>
                          {% endif %}
                          {% if content.field_allegati_doc_pubblico[0] is not empty %}
                          <li class="nav-item">
                            <a class="nav-link" href="#allegati-doc-pubblico">
                              <span class="title-medium">Allegati</span>
                            </a>
                          </li>
                          {% endif %}
                          {% if content.field_ulteriori_informazioni[0] is not empty %}
                          <li class="nav-item">
                            <a class="nav-link" href="#ulteriori-informazioni">
                              <span class="title-medium">Ulteriori informazioni</span>
                            </a>
                          </li>
                          {% endif %}
                        </ul>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </nav>
      </div>
    </div>

    <div class="col-12 col-lg-8 offset-lg-1">
      <div class="it-page-sections-container">
        {% if content.field_competenze[0] is not empty %}
        <section class="it-page-section mb-30">
          <h2 class="title-xxlarge mb-3" id="competenze">Competenze</h2>
          <div class="richtext-wrapper lora">
            {{ content.field_competenze }}
          </div>
        </section>
        {% endif %}

        {% if drupal_view_result('persone_collegate', 'block_3', node.id) %}
          <section class="it-page-section mb-30">
            <h2 class="title-xxlarge mb-3" id="persone-responsabili">Responsabili</h2>
              <div class="container my-3">
                {{ drupal_view('persone_collegate', 'block_3', node.id) }}
              </div>
          </section>
        {% endif %}

        {% if drupal_view_result('persone_collegate', 'block_4', node.id) %}
        <section class="it-page-section mb-30">
          <h2 class="title-xxlarge mb-3" id="persone">Persone che compongono la struttura</h2>
          <div class="container my-3">
            {{ drupal_view('persone_collegate', 'block_4', node.id) }}
          </div>
        </section>
        {% endif %}

        {% if drupal_view_result('servizi_collegati', 'block_2', node.id) %}
          <section class="it-page-section mb-30">
            <h2 class="title-xxlarge mb-3" id="elenco-servizi-offerti">Servizi offerti</h2>
              <div class="container my-3">
                {{ drupal_view('servizi_collegati', 'block_2', node.id) }}
              </div>
          </section>
        {% endif %}
        
        {% include '@comuni_theme/templates/paragraphs/parts/paragraph--parts--card.html.twig' with { 'cols': 2, 'label': 'Sede principale', 'id': 'sede-principale', 'content': (content.field_sedi["#items"] is null ? null : content.field_sedi["#items"]|map(item => "#{item.target_id}")|join('+')) } %}
        
        <section class="it-page-section">
          <div class="container p-0">
            <div class="row row-cols-lg-2 row-cols-1 g-4 mx-0">
              {% set contatti = [] %}
              {% if content.field_contatti[0] is not empty %}
                {#} unita_organizzativa.field_contatti è popolato {#}
                {% set contatti = contatti|merge([content.field_contatti["#items"]|map(item => "#{item.target_id}" )|join(',')]) %}
              {% else %}
                {% for item in node.field_sede_principale %}
                  {% set tmp_field_contatti = drupal_field('field_punti_di_contatto', 'node', item.target_id) %}
                  {% if tmp_field_contatti[0] is not empty %}
                    {#} luogo.field_punti_di_contatto è popolato {#}
                    {% set contatti = contatti|merge([tmp_field_contatti["#items"]|map(item => "#{item.target_id}" )|join(',')]) %}
                  {% endif %}
                {% endfor %}
              {% endif %}
              {% include '@comuni_theme/templates/node/parts/node--parts--1-card.html.twig' with { 'label': 'Contatti', 'content': contatti|join(','), 'id': 'contatti' } %}

              {% include '@comuni_theme/templates/node/parts/node--parts--1-card.html.twig' with { 'label': 'Ufficio responsabile', 'content': (content.field_unita_org_genitore["#items"] is null ? null : content.field_unita_org_genitore["#items"]|map(item => "#{item.target_id}" )|join(',')), 'id': 'unita-org-genitore' } %}
            </div>
          </div>
        </section>

        {% include '@comuni_theme/templates/node/parts/node--parts--2-card.html.twig' with { 'label': 'Allegati', 'content': (content.field_allegati_doc_pubblico["#items"] is null ? null : content.field_allegati_doc_pubblico["#items"]|map(item => "#{item.target_id}" )|join(',')), 'id': 'allegati-doc-pubblico' } %}

        {% include '@comuni_theme/templates/node/parts/node--parts--ulteriori-informazioni.html.twig' with { 'label': 'Ulteriori informazioni', 'content': content.field_ulteriori_informazioni, 'id': 'ulteriori_informazioni' } %}
        {% include '@comuni_theme/templates/node/parts/node--parts--ultimo-aggiornamento.html.twig' with { 'content': node.changed } %}

      </div>
    </div>
  </div>
</div>