<div class="container"> 
  <div class="row">
    <div class="col">
      {{ title_prefix }}
      {% if node.label %}
        <h1{{ title_attributes }} data-audio>
            {{ node.label }}
        </h1>
      {% endif %}
      {{ title_suffix }}
      {% if content.field_data_e_orario_di_inizio[0] %}
          {% set data_inizio = content.field_data_e_orario_di_inizio[0]["#text"] %}
          {% set data_inizio = data_inizio|date('d') ~ " " ~ data_inizio|date('M')|t|lower  ~ " " ~ data_inizio|date('Y') %}
          {% set data_fine = content.field_data_e_orario_di_fine[0]["#text"] %}
          {% set data_fine = data_fine|date('d') ~ " " ~  data_fine|date('M')|t|lower  ~ " " ~ data_fine|date('Y') %}
        <h2 class="h4 py-2">dal {{ data_inizio }}
            {% if content.field_data_e_orario_di_fine[0] %}
              al {{ data_fine }}
            {% endif %}
        </h2>
      {% endif %}
      {% if content.field_descrizione_breve %}
        <p data-audio>{{ content.field_descrizione_breve }}</p>
      {% endif %}
    </div>
      <div class="col-lg-3 offset-lg-1">
        {{ drupal_block("social_sharing_buttons_block") }}

        <div class="dropdown d-inline">
          <button type="button" id="viewActions" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false" aria-label="vedi azioni da compiere sulla pagina" class="btn btn-dropdown dropdown-toggle text-decoration-underline d-inline-flex align-items-center fs-0">
            <svg class="icon"><use href="#it-more-items" /></svg>
            <small>Vedi azioni</small>
          </button>
          <div class="dropdown-menu shadow-lg" aria-labelledby="viewActions">
            <div class="link-list-wrapper">
              <ul class="link-list">
                <li>
                  <a class="list-item" href="javascript:window.print()">
                      <svg class="icon">
                          <use href="#it-print" />
                      </svg>
                    <span>Stampa</span>
                  </a>
                </li>
                <li>
                  <a class="list-item" href="#">
                      <svg class="icon">
                          <use href="#it-hearing" />
                      </svg>
                      <span>Ascolta</span>
                  </a>
                </li>
                <li>
                  <a class="list-item" href="mailto:?subject={{ node.label }}&body={{ url }}" target="_blank" rel="noopener"
                    title="{{ 'Invia'|t }} E-mail" aria-label="{{ 'Invia'|t }} E-mail">
                      <svg class="icon">
                          <use href="#it-mail" />
                      </svg>
                      <span>Invia</span>{# TODO Label #}
                  </a>
                </li>
              </ul>
            </div>
          </div>
        </div>
        <div class="mt-4 mb-4">
          {% if content.field_argomenti[0] is not empty %}
            <span class="subtitle-small">Argomenti</span>
            <div class="chip-wrapper mt-2">
              {% for item in attribute(content.field_argomenti, "#items") %}
                {% set arg_name = item.entity.name.value %}
                <a href="{{ path('entity.taxonomy_term.canonical', {'taxonomy_term': item.target_id}) }}">
                  <div class="chip chip-simple chip-primary">
                    <span class="chip-label">{{ arg_name }}</span>
                  </div>
                </a>
              {% endfor %}
            </div>
          {% endif %}
        </div>
        <div class="mt-4 mb-4">
          {% if content.field_tipo_di_evento[0] is not empty %}
            <span class="subtitle-small">Tipo di evento</span>
            <div class="chip-wrapper mt-2">
              {% for item in attribute(content.field_tipo_di_evento, "#items") %}
                {% set arg_name = item.entity.name.value %}
                <a href="{{ path('entity.taxonomy_term.canonical', {'taxonomy_term': item.target_id}) }}">
                  <div class="chip chip-simple chip-primary">
                    <span class="chip-label">{{ arg_name }}</span>
                  </div>
                </a>
              {% endfor %}
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>

{% if content.field_immagine[0] %}
  <div class="container-fluid my-3">
    <div class="row">
      <figure class="figure px-0 img-full">
        <img src="{{ file_url(node.field_immagine.entity.field_media_image.entity.fileuri) }}" class="figure-img img-fluid"
             alt="{{ node.field_immagine.entity.field_media_image.alt }}">
        <figcaption class="figure-caption text-center pt-3">{{ node.field_immagine.entity.field_media_image.alt }}</figcaption>
      </figure>
    </div>
  </div>
{% endif %}

<div class="container">
  <div class="row border-top row-column-border row-column-menu-left">
    <aside class="col-lg-4">
      <div class="cmp-navscroll sticky-top" aria-labelledby="accordion-title-one">
        <nav class="navbar it-navscroll-wrapper navbar-expand-lg" aria-label="INDICE DELLA PAGINA" data-bs-navscroll>
          <div class="navbar-custom" id="navbarNavProgress">
            <div class="menu-wrapper">
              <div class="link-list-wrapper">
                <div class="accordion">
                  <div class="accordion-item">
                      <span class="accordion-header" id="accordion-title-one">
                        <button class="accordion-button pb-10 px-3" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-one" aria-expanded="true" aria-controls="collapse-one">
                          INDICE DELLA PAGINA
                          <svg class="icon icon-xs right"><use href="#it-expand" /></svg>
                        </button>
                      </span>
                    <div class="progress">
                      <div class="progress-bar it-navscroll-progressbar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <div id="collapse-one" class="accordion-collapse collapse show" role="region" aria-labelledby="accordion-title-one">
                      <div class="accordion-body">
                        <ul class="link-list" data-element="page-index">
                            {% if content.field_descrizione_completa[0] is not empty  %}
                              <li class="nav-item">
                                <a class="nav-link" href="#cos-e">
                                  <span class="title-medium">Cos'è</span>
                                </a>
                              </li>
                            {% endif %}
                            {% if node.field_luogo[0] is not empty %}
                              <li class="nav-item">
                                <a class="nav-link" href="#luogo">
                                  <span class="title-medium">Luogo</span>
                                </a>
                              </li>
                            {% endif %}
                            {% if content.field_data_e_orario_di_inizio[0] is not empty %}
                              <li class="nav-item">
                                <a class="nav-link" href="#date-e-orari">
                                  <span class="title-medium">Date e orari</span>
                                </a>
                              </li>
                            {% endif %}
                            {% if content.field_costo[0] is not empty %}
                              <li class="nav-item">
                                <a class="nav-link" href="#costi">
                                  <span class="title-medium">Costi</span>
                                </a>
                              </li>
                            {% endif %}
                            {% if content.field_allegati[0] is not empty %}
                              <li class="nav-item">
                                <a class="nav-link" href="#allegati">
                                  <span class="title-medium">Allegati</span>
                                </a>
                              </li>
                            {% endif %}
                            {% if drupal_view_result('eventi_collegati', 'block_1', node.id) is not empty %}
                              <li class="nav-item">
                                <a class="nav-link" href="#appuntamenti">
                                  <span class="title-medium">Appuntamenti</span>
                                </a>
                              </li>
                            {% endif %}
                            {% if content.field_punti_di_contatto[0] is not empty or content.field_organizzato_da[0] is not empty %}
                              <li class="nav-item">
                                <a class="nav-link" href="#contatti">
                                  <span class="title-medium">Contatti</span>
                                </a>
                              </li>
                            {% endif %}
                            {% if content.field_ulteriori_informazioni[0] is not empty %}
                              <li class="nav-item">
                                <a class="nav-link" href="#ulteriori-informazioni">
                                  <span class="title-medium">Ulteriori informazioni</span>
                                </a>
                              </li>
                            {% endif %}
                        </ul>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </nav>
      </div>
    </aside>
    <section class="col-lg-8 it-page-sections-container border-light">
      {% if content.field_descrizione_completa [0] is not empty %}
        <article id="cos-e" class="it-page-section mb-30" data-audio>
          <h2 class="title-xxlarge mb-3">Cos'è?</h2>
          <div class="font-serif">
              {{ content.field_descrizione_completa }}
          </div>
          {% include '@comuni_theme/templates/node/parts/node--parts--2-card.html.twig' with { 'label': 'Parteciperanno', 'content': (content.field_persone["#items"] is null ? null : content.field_persone["#items"]|map(item => "#{item.target_id}" )|join(',')), 'id': 'field_persone' } %}
          {#% if content.field_galleria_immagini[0] is not empty %}
            <div class="it-carousel-wrapper it-carousel-landscape-abstract-three-cols splide" data-bs-carousel-splide="" id="splide01">
                {{ content.field_galleria_immagini }}
            </div>
          {% endif %#}
          {#% if content.field_video_esterno %}
              {{content.field_video_esterno}}
          {% endif %#}
        </article>
      {% endif %}

      {% if content.field_a_chi_e_rivolto [0] is not empty %}
        <article id="destinatari" class="it-page-section mb-30">
          <h2 class="mb-3">A chi è rivolto</h2>
          <div class="richtext-wrapper lora">
            {{ content.field_a_chi_e_rivolto }}
          </div>
        </article>
      {% endif %}

      {% if content.field_luogo[0] is not empty %}
        {% set tmp = drupal_entity('node', content.field_luogo["#items"][0].target_id)["#node"] %}
        <section class="it-page-section mb-5 card-indirizzo-luogo">
          <h2 class="title-xxlarge mb-3" id="luogo">Luogo</h2>
          <p class="richtext-wrapper lora">
            {{ tmp.field_indirizzo[0].value }}, {{ tmp.field_cap[0].value }}{% if tmp.field_quartiere[0] is not empty %}, {{ tmp.field_quartiere[0].value }}{% endif %}
          </p>
          <div class="container">
            {% if tmp.field_coordinate_geografiche[0] is not empty %}
              {{ drupal_field('field_coordinate_geografiche', 'node', content.field_luogo["#items"][0].target_id) }}
            {% endif %}
          </div>
        </section>
      {% endif %}

      {% if content.field_data_e_orario_di_inizio[0] is not empty %}
        <article id="date-e-orari" class="it-page-section mb-30">
          <h2 class="mb-3">Date e orari</h2>
          <div class="point-list-wrapper">
            <div class="point-list">
              <h3 class="point-list-aside point-list-primary fw-normal">
                <div class="point-date font-monospace">{{ content.field_data_e_orario_di_inizio[0]["#text"]|date('d') }}</div>
                <div class="point-month font-monospace">{{ content.field_data_e_orario_di_inizio[0]["#text"]|date('M')|t }}</div>
              </h3>
              <div class="point-list-content">
                <div class="card card-teaser shadow rounded">
                  <div class="card-body">
                    <h3 class="card-title h5 m-0">{% if content.field_data_e_orario_di_inizio[0]["#text"]|date('H') != '00' or content.field_data_e_orario_di_inizio[0]["#text"]|date('i') != '00' or content.field_data_e_orario_di_inizio[0]["#text"]|date('s') != '00' %}{{ content.field_data_e_orario_di_inizio[0]["#text"]|date('H:i')}} - {% endif %}Inizio evento </h3>
                  </div>
                </div>
              </div>
            </div>
            {% if content.field_data_e_orario_di_fine[0] is not empty %}
              <div class="point-list mb-30">
                <h3 class="point-list-aside point-list-primary fw-normal">
                  <div class="point-date font-monospace">{{ content.field_data_e_orario_di_fine[0]["#text"]|date('d') }}</div>
                  <div class="point-month font-monospace">{{ content.field_data_e_orario_di_fine[0]["#text"]|date('M')|t }}</div>
                </h3>
                <div class="point-list-content">
                  <div class="card card-teaser shadow rounded">
                    <div class="card-body">
                      <h3 class="card-title h5 m-0">{% if content.field_data_e_orario_di_fine[0]["#text"]|date('H') != '00' or content.field_data_e_orario_di_fine[0]["#text"]|date('i') != '00' or content.field_data_e_orario_di_fine[0]["#text"]|date('s') != '00' %}{{ content.field_data_e_orario_di_fine[0]["#text"]|date('H:i')}} - {% endif %}Fine evento</h3>
                    </div>
                  </div>
                </div>
              </div>
            {% endif %}
          </div>
            {# TODO Label #}<p class="font-serif">Per informazioni sul programma dettagliato degli appuntamenti religiosi e civili, consultare il programma nella sezione documenti.</p>
          <div class="mt-3">
            {% set calendar_inizio = content.field_data_e_orario_di_inizio[0]["#text"]|date('Ymd', 'UTC') %}
            {% set calendar_inizio = calendar_inizio ~ 'T' ~ content.field_data_e_orario_di_inizio[0]["#text"]|date('His', 'UTC') %}
            {% set calendar_inizio = calendar_inizio ~ 'Z' %}
            {% set calendar_fine = content.field_data_e_orario_di_fine[0]["#text"]|date('Ymd', 'UTC') %}
            {% set calendar_fine = calendar_fine ~ 'T' ~ content.field_data_e_orario_di_fine[0]["#text"]|date('His', 'UTC') %}
            {% set calendar_fine = calendar_fine ~ 'Z' %}
            <a href="https://calendar.google.com/calendar/render?action=TEMPLATE&dates={{ calendar_inizio }}/{{ calendar_fine }}&text={{ node.label|replace({' ': '%20'}) }}" target="_blank" class="btn btn-outline-primary btn-icon">
                <svg class="icon icon-primary">
                    <use href="#it-plus-circle" />
                </svg>
              <span>Aggiungi al calendario</span>{# TODO Label #}
            </a>
          </div>
        </article>
      {% endif %}

      {% if content.field_costo[0] is not empty %}
        <article id="costi" class="it-page-section mb-30">
          <h2 class="mb-3">Costi</h2>
            {{ content.field_costo }}
        </article>
      {% endif %}

      {% if content.field_allegati[0] is not empty %}
        {% include '@comuni_theme/templates/node/parts/node--parts--2-media.html.twig' with { 'label': 'Allegati', 'content': content.field_allegati, 'id': 'allegati' } %}
      {% endif %}

      {% if content.field_evento_genitore[0] is not empty %}
        {% include '@comuni_theme/templates/node/parts/node--parts--2-card.html.twig' with { 'label': 'Evento principale', 'content': (content.field_evento_genitore["#items"] is null ? null : content.field_evento_genitore["#items"]|map(item => "#{item.target_id}" )|join(',')), 'id': 'field_evento_genitore' } %}
      {% endif %}

      {% if drupal_view_result('eventi_collegati', 'block_1', node.id) is not empty %}
        <article id="appuntamenti" class="it-page-section mb-30">
          <h2 class="mb-3">Appuntamenti</h2>
          <div class="container">
            {{ drupal_view('eventi_collegati', 'block_1', node.id) }}
          </div>
        </article>
      {% endif %}

      {% if content.field_punti_di_contatto[0] is not empty or content.field_organizzato_da[0] is not empty %}
        <article id="contatti" class="it-page-section mb-5">
          <div class="container p-0">
            <div class="row row-cols-lg-2 row-cols-1 g-4 mx-0">
              {% include '@comuni_theme/templates/node/parts/node--parts--1-card.html.twig' with { 'label': 'Contatti', 'content': (content.field_punti_di_contatto["#items"]|map(item => "#{item.target_id}" )|join(',')), 'id': 'contacts' } %}

              {% include '@comuni_theme/templates/node/parts/node--parts--1-card.html.twig' with { 'label': 'Con il supporto di', 'content': (content.field_organizzato_da["#items"]|map(item => "#{item.target_id}" )|join(',')), 'id': 'field_organizzato_da' } %}
            </div>
          </div>
        </article>
      {% endif %}

      {% include '@comuni_theme/templates/node/parts/node--parts--2-media.html.twig' with { 'label': 'Patrocinato da:', 'content': content.field_patrocinato_da, 'id': 'patrocinato-da' } %}
      {% include '@comuni_theme/templates/node/parts/node--parts--2-media.html.twig' with { 'label': 'Sponsor:', 'content': content.field_sponsor, 'id': 'patrocinato-da' } %}

      {% if content.field_ulteriori_informazioni[0] is not empty %}
        <article id="ulteriori-informazioni" class="it-page-section mb-5">
          <h2 class="mb-3">Ulteriori informazioni</h2>
              <div class="mt-4">
                <div class="callout">
                  <div class="callout-title">
                    <svg class="icon">
                      <use href="#it-info-circle" />
                    </svg>
                  </div>
                    {{ content.field_ulteriori_informazioni }}
                </div>
              </div>
        </article>
      {% endif %}

      {% if node.changed[0] %}
        <article id="ultimo-aggiornamento" class="anchor-offset mt-5">
          <h5 class="font-serif">Ultimo aggiornamento</h5>
          <p class="h6"><strong>{{ node.changed[0].value | format_date('medium') }}</strong></p>
        </article>
      {% endif %}
    </section>
  </div>
</div>